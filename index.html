import React, { useState, useMemo } from 'react';
import { CheckCircle, Circle, Plus } from 'lucide-react';

const TodoApp = () => {
  const [schedule, setSchedule] = useState([
    {
      time: "4:00",
      tasks: [
        { id: '1', text: 'ポットスイッチ', completed: false },
        { id: '2', text: 'うがい', completed: false },
        { id: '3', text: '洗濯', completed: false },
        { id: '4', text: 'ヨガ（10分）', completed: false, category: 'S', duration: 10 },
      ],
    },
    {
      time: "5:00",
      tasks: [
        { id: 'a', text: 'コーヒー', completed: false },
        { id: 'b', text: '読書（15分）', completed: false, category: 'S', duration: 15 },
      ],
    },
  ]);

  const [newTask, setNewTask] = useState({ category: 'E', text: '', duration: 5 });

  const toggleTask = (timeIndex, taskId) => {
    const updatedSchedule = [...schedule];
    const task = updatedSchedule[timeIndex].tasks.find((t) => t.id === taskId);
    if (task) task.completed = !task.completed;
    setSchedule(updatedSchedule);
  };

  const resetTasks = () => {
    setSchedule(schedule.map((timeBlock) => ({
      ...timeBlock,
      tasks: timeBlock.tasks.map((task) => ({ ...task, completed: false })),
    })));
  };

  const addTask = () => {
    if (newTask.text.trim() && newTask.duration) {
      setSchedule((prev) => [
        ...prev,
        {
          time: "新しい時間",
          tasks: [
            {
              id: Math.random().toString(36).substring(7),
              text: `${newTask.text}（${newTask.duration}分）`,
              completed: false,
              category: newTask.category,
              duration: newTask.duration,
            },
          ],
        },
      ]);
      setNewTask({ category: 'E', text: '', duration: 5 });
    }
  };

  return (
    <div className="max-w-sm mx-auto bg-gray-100 p-6 rounded-lg shadow-lg space-y-4">
      <div className="text-center">
        <h1 className="text-3xl font-bold text-blue-700">My Routine</h1>
        <button
          onClick={resetTasks}
          className="text-lg text-red-500 hover:text-red-700 mt-4"
        >
          リセット
        </button>
      </div>

      {schedule.map((timeBlock, index) => (
        <div key={timeBlock.time} className="bg-white p-4 rounded-lg shadow-md space-y-2">
          <h2 className="text-xl font-semibold text-gray-800">{timeBlock.time}</h2>
          {timeBlock.tasks.map((task) => (
            <div
              key={task.id}
              className="flex items-center p-2 bg-gray-50 rounded-lg shadow-sm cursor-pointer"
              onClick={() => toggleTask(index, task.id)}
            >
              {task.completed ? (
                <CheckCircle color="green" size={24} />
              ) : (
                <Circle color="gray" size={24} />
              )}
              <span className={`ml-4 text-lg ${task.completed ? 'line-through text-gray-400' : 'text-gray-800'}`}>
                {task.text}
              </span>
            </div>
          ))}
        </div>
      ))}

      <div className="bg-white p-4 rounded-lg shadow-md space-y-4">
        <h3 className="text-xl font-semibold text-gray-800">新しいタスクを追加</h3>
        <div className="flex flex-col space-y-3">
          <input
            type="text"
            placeholder="タスク名"
            value={newTask.text}
            onChange={(e) => setNewTask((prev) => ({ ...prev, text: e.target.value }))}
            className="p-2 border rounded-lg"
          />
          <input
            type="number"
            placeholder="時間（分）"
            value={newTask.duration}
            onChange={(e) => setNewTask((prev) => ({ ...prev, duration: e.target.value }))}
            className="p-2 border rounded-lg"
          />
          <button
            onClick={addTask}
            className="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-700"
          >
            タスクを追加
          </button>
        </div>
      </div>
    </div>
  );
};

export default TodoApp;
