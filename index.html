import React, { useState, useMemo } from 'react';
import { CheckCircle, Circle, Plus } from 'lucide-react';

const TodoApp = () => {
  const [schedule, setSchedule] = useState([
    {
      time: "4:00",
      tasks: [
        { id: '1', text: 'ポットスイッチ', completed: false },
        { id: '2', text: 'うがい', completed: false },
        { id: '3', text: '洗濯', completed: false },
        { id: '4', text: 'ヨガ（10分）', completed: false, category: 'S', duration: 10 },
        { id: '5', text: '体重測定', completed: false },
      ]
    },
    {
      time: "5:00",
      tasks: [
        { id: 'a', text: 'コーヒー', completed: false },
        { id: 'b', text: '読書（15分）', completed: false, category: 'S', duration: 15 },
      ]
    }
  ]);

  const [customTasks, setCustomTasks] = useState({
    E: [],
    S: [],
    M: [],
    L: [],
    H: []
  });

  const [newTask, setNewTask] = useState({
    category: 'E',
    text: '',
    duration: 5
  });

  const toggleTask = (timeIndex, taskId) => {
    const newSchedule = [...schedule];
    const task = newSchedule[timeIndex].tasks.find(t => t.id === taskId);
    if (task) task.completed = !task.completed;
    setSchedule(newSchedule);
  };

  const resetTasks = () => {
    setSchedule(schedule.map(timeBlock => ({
      ...timeBlock,
      tasks: timeBlock.tasks.map(task => ({ ...task, completed: false }))
    })));
    setCustomTasks({
      E: [],
      S: [],
      M: [],
      L: [],
      H: []
    });
  };

  const addCustomTask = () => {
    if (newTask.text && newTask.duration) {
      const newEntry = {
        text: `${newTask.text}（${newTask.duration}分）`,
        completed: false,
        category: newTask.category,
        duration: parseInt(newTask.duration),
      };
      setCustomTasks(prev => ({
        ...prev,
        [newTask.category]: [...prev[newTask.category], newEntry],
      }));
      setNewTask({ category: 'E', text: '', duration: 5 });
    }
  };

  return (
    <div className="max-w-sm mx-auto bg-gray-50 shadow-lg rounded-xl p-6 mt-6">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-4xl font-bold text-blue-800">My Routine</h1>
        <button onClick={resetTasks} className="text-blue-600 hover:text-blue-800 text-xl">
          リセット
        </button>
      </div>
      {schedule.map((block, index) => (
        <div key={block.time} className="mb-6">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">{block.time}</h2>
          {block.tasks.map(task => (
            <div
              key={task.id}
              className="flex items-center mb-3 p-3 bg-white rounded-lg shadow-md cursor-pointer"
              onClick={() => toggleTask(index, task.id)}
            >
              {task.completed ? (
                <CheckCircle color="green" size={28} />
              ) : (
                <Circle color="gray" size={28} />
              )}
              <span className={`ml-4 text-2xl ${task.completed ? 'line-through text-gray-400' : 'text-gray-800'}`}>
                {task.text}
              </span>
            </div>
          ))}
        </div>
      ))}
      <div className="p-6 bg-white shadow-md rounded-lg">
        <h3 className="text-2xl font-semibold text-gray-800 mb-4">タスクを追加</h3>
        <div className="flex flex-col space-y-4">
          <div className="flex items-center space-x-2">
            <select
              value={newTask.category}
              onChange={(e) => setNewTask({ ...newTask, category: e.target.value })}
              className="border rounded-lg px-4 py-2 flex-shrink-0 text-lg"
            >
              {['E', 'S', 'M', 'L', 'H'].map(cat => (
                <option key={cat} value={cat}>
                  {cat}
                </option>
              ))}
            </select>
            <input
              type="text"
              value={newTask.text}
              placeholder="タスク名"
              onChange={(e) => setNewTask({ ...newTask, text: e.target.value })}
              className="flex-grow border rounded-lg px-4 py-2 text-lg"
            />
            <input
              type="number"
              value={newTask.duration}
              placeholder="分"
              onChange={(e) => setNewTask({ ...newTask, duration: e.target.value })}
              className="w-24 border rounded-lg px-4 py-2 text-lg flex-shrink-0"
            />
          </div>
          <button onClick={addCustomTask} className="bg-blue-500 text-white rounded-lg px-4 py-3 text-xl">
            <Plus size={28} />
          </button>
        </div>
      </div>
    </div>
  );
};

export default TodoApp;
